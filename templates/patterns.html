<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ - CryptoAnalyst Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/patterns.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìà</text></svg>">
</head>
\1
{%include '_lang_header.html'%}

    <div class="container">
        <header class="crypto-header">
            <div class="header-content">
                <div class="logo-container">
                    <a href="/" class="logo-link">
                        <div class="logo">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="logo-text">
                            <h1 class="logo-title">CryptoAnalyst Pro</h1>
                            <div class="logo-subtitle">Patterns Encyclopedia</div>
                        </div>
                    </a>
                </div>

                <div class="header-nav">
                    <a href="/" class="nav-item">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">–ì–ª–∞–≤–Ω–∞—è</span>
                    </a>

                    <a href="/analyze?symbol=BTCUSDT" class="nav-item">
                        <div class="nav-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <span class="nav-text">–ê–Ω–∞–ª–∏–∑</span>
                    </a>

                    <div class="nav-item" id="theme-toggle">
                        <div class="nav-icon">
                            <i class="fas fa-moon"></i>
                        </div>
                        <span class="nav-text">–¢–µ–º–∞</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="patterns-main">
            <!-- Hero Section -->
            <section class="patterns-hero">
                <div class="hero-content">
                    <h1><i class="fas fa-shapes"></i> –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤</h1>
                    <p class="hero-description">
                        –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
                        –ò–∑—É—á–∞–π—Ç–µ, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–π—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
                    </p>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <i class="fas fa-project-diagram"></i>
                            <span>20+ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-chart-line"></i>
                            <span>–†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-lightbulb"></i>
                            <span>–¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Search and Filter Section -->
            <section class="patterns-controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="pattern-search" placeholder="–ü–æ–∏—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤..." class="search-input">
                </div>

                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                    <button class="filter-btn" data-filter="reversal">–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–µ</button>
                    <button class="filter-btn" data-filter="continuation">–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</button>
                    <button class="filter-btn" data-filter="candlestick">–°–≤–µ—á–Ω—ã–µ</button>
                </div>

                <div class="view-controls">
                    <button class="view-btn active" data-view="grid">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" data-view="list">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </section>

            <!-- Patterns Grid -->
            <section class="patterns-container">
                <div class="patterns-grid" id="patterns-grid">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤...</p>
                    </div>
                </div>
            </section>

            <!-- Pattern Detail Modal -->
            <div class="modal-overlay" id="pattern-modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-title">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞</h3>
                        <button class="modal-close" id="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body" id="modal-body">
                        <!-- Content will be loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Educational Section -->
            <section class="educational-section">
                <h2><i class="fas fa-graduation-cap"></i> –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏</h2>

                <div class="education-grid">
                    <div class="education-card">
                        <i class="fas fa-binoculars"></i>
                        <h4>1. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ</h4>
                        <p>–ò—â–∏—Ç–µ —á–µ—Ç–∫–∏–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ. –ü–∞—Ç—Ç–µ—Ä–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ä–æ—à–æ –≤–∏–¥–∏–º—ã–º –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é.</p>
                    </div>

                    <div class="education-card">
                        <i class="fas fa-check-circle"></i>
                        <h4>2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h4>
                        <p>–î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞. –ò—â–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–∞–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏.</p>
                    </div>

                    <div class="education-card">
                        <i class="fas fa-arrow-right"></i>
                        <h4>3. –í—Ö–æ–¥</h4>
                        <p>–í—Ö–æ–¥–∏—Ç–µ –≤ —Å–¥–µ–ª–∫—É –ø–æ—Å–ª–µ –ø—Ä–æ–±–æ—è –∫–ª—é—á–µ–≤—ã—Ö —É—Ä–æ–≤–Ω–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–æ–ø-–ª–æ—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏.</p>
                    </div>

                    <div class="education-card">
                        <i class="fas fa-target"></i>
                        <h4>4. –¶–µ–ª–∏</h4>
                        <p>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ—Ä–µ–Ω–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω–∞. –§–∏–∫—Å–∏—Ä—É–π—Ç–µ –ø—Ä–∏–±—ã–ª—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.</p>
                    </div>
                </div>
            </section>

            <!-- Common Mistakes Section -->
            <section class="mistakes-section">
                <h2><i class="fas fa-exclamation-triangle"></i> –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏</h2>

                <div class="mistakes-list">
                    <div class="mistake-item">
                        <i class="fas fa-times-circle"></i>
                        <div class="mistake-content">
                            <h4>–¢–æ—Ä–≥–æ–≤–ª—è –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h4>
                            <p>–ù–µ –≤—Ö–æ–¥–∏—Ç–µ –≤ —Å–¥–µ–ª–∫—É –¥–æ –ø–æ–ª–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞. –¢–µ—Ä–ø–µ–Ω–∏–µ - –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É.</p>
                        </div>
                    </div>

                    <div class="mistake-item">
                        <i class="fas fa-times-circle"></i>
                        <div class="mistake-content">
                            <h4>–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–º–∞</h4>
                            <p>–û–±—ä–µ–º - –≤–∞–∂–Ω–µ–π—à–∏–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π —Ñ–∞–∫—Ç–æ—Ä. –ë–µ–∑ –æ–±—ä–µ–º–∞ –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–µ–Ω–∞–¥–µ–∂–µ–Ω.</p>
                        </div>
                    </div>

                    <div class="mistake-item">
                        <i class="fas fa-times-circle"></i>
                        <div class="mistake-content">
                            <h4>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞</h4>
                            <p>–í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å—Ç–æ–ø-–ª–æ—Å—Å. –ù–∏ –æ–¥–∏–Ω –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–µ –¥–∞–µ—Ç 100% –≥–∞—Ä–∞–Ω—Ç–∏–∏.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="patterns-footer">
            <div class="footer-content">
                <p>&copy; 2025 CryptoAnalyst Pro | –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤</p>
                <p class="educational-note">
                    <i class="fas fa-info-circle"></i>
                    –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–æ–¥–∏—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑.
                </p>
            </div>
        </footer>
    </div>

    <!-- Data templates for patterns -->
    <template id="pattern-card-template">
    <div class="pattern-card" data-type="" data-name="">
        <div class="pattern-header">
            <div class="pattern-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="pattern-title">
                <h3 class="pattern-name"></h3>
                <span class="pattern-type-badge"></span>
            </div>
        </div>

        <!-- –î–û–ë–ê–í–ò–¢–¨ –≠–¢–û–¢ –ë–õ–û–ö -->
        <div class="pattern-visual">
            <img src="" alt="" class="pattern-image">
            <div class="image-fallback" style="display: none;">
                <i class="fas fa-image"></i>
                <span>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>
            </div>
        </div>

        <div class="pattern-body">
            <p class="pattern-description"></p>
            <div class="pattern-meta">
                <span class="pattern-reliability">
                    <i class="fas fa-star"></i>
                    <span class="reliability-text"></span>
                </span>
                <span class="pattern-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span class="trend-direction"></span>
                </span>
            </div>
        </div>
        <div class="pattern-actions">
            <button class="pattern-details-btn">
                <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
            </button>
        </div>
    </div>
</template>

    <template id="pattern-modal-template">
        <div class="pattern-details">
            <div class="detail-section">
                <img src="" alt="" class="modal-pattern-image">
            </div>

            <div class="detail-section">
                <h4><i class="fas fa-info-circle"></i> –û–ø–∏—Å–∞–Ω–∏–µ</h4>
                <p class="detail-description"></p>
            </div>

            <div class="detail-section">
                <h4><i class="fas fa-bullseye"></i> –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</h4>
                <div class="signals-grid">
                    <div class="signal-item">
                        <i class="fas fa-arrow-right"></i>
                        <strong>–í—Ö–æ–¥:</strong> <span class="signal-entry"></span>
                    </div>
                    <div class="signal-item">
                        <i class="fas fa-shield-alt"></i>
                        <strong>–°—Ç–æ–ø-–ª–æ—Å—Å:</strong> <span class="signal-stop"></span>
                    </div>
                    <div class="signal-item">
                        <i class="fas fa-target"></i>
                        <strong>–¶–µ–ª—å:</strong> <span class="signal-target"></span>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h4><i class="fas fa-chart-bar"></i> –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
                <ul class="pattern-features"></ul>
            </div>

            <div class="detail-section">
                <h4><i class="fas fa-lightbulb"></i> –°–æ–≤–µ—Ç—ã –ø–æ —Ç–æ—Ä–≥–æ–≤–ª–µ</h4>
                <div class="trading-tips"></div>
            </div>

            <div class="detail-section">
                <h4><i class="fas fa-exclamation-triangle"></i> –ß—Ç–æ –∏—Å–∫–∞—Ç—å</h4>
                <div class="key-points"></div>
            </div>
        </div>
    </template>

    <script src="{{ url_for('static', filename='js/patterns.js') }}"></script>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
            loadPatternsData();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–æ–π
            initTheme();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            initSearchAndFilters();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            initModal();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
        async function loadPatternsData() {
            try {
                const container = document.getElementById('patterns-grid');
                container.innerHTML = `
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤...</p>
                    </div>
                `;

                const response = await fetch('/api/patterns');
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');

                const data = await response.json();

                if (data.success) {
                    renderPatterns(data.patterns);
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:', error);
                showErrorState('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤');
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
        function renderPatterns(patterns) {
            const container = document.getElementById('patterns-grid');

            if (!patterns || patterns.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>–ü–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                `;
                return;
            }

            const template = document.getElementById('pattern-card-template');

            container.innerHTML = patterns.map(pattern => {
                return `
                    <div class="pattern-card" data-type="${getPatternTypeClass(pattern.type)}" data-name="${pattern.name.toLowerCase()}">
                        <div class="pattern-header">
                            <div class="pattern-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="pattern-title">
                                <h3 class="pattern-name">${pattern.name}</h3>
                                <span class="pattern-type-badge ${getPatternTypeClass(pattern.type)}">
                                    ${pattern.type}
                                </span>
                            </div>
                        </div>

                        <div class="pattern-body">
                            <p class="pattern-description">${pattern.description}</p>

                            <div class="pattern-meta">
                                <span class="pattern-reliability">
                                    <i class="fas fa-star"></i>
                                    <span class="reliability-text">${pattern.confidence}</span>
                                </span>
                                <span class="pattern-trend">
                                    <i class="fas fa-arrow-up"></i>
                                    <span class="trend-direction">${getTrendDirection(pattern.type)}</span>
                                </span>
                            </div>
                        </div>

                        <div class="pattern-actions">
                            <button class="pattern-details-btn" data-pattern='{"name":"${pattern.name}","type":"${pattern.type}","confidence":"${pattern.confidence}","description":"${pattern.description}"}'>
                                <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
            setTimeout(() => {
                document.querySelectorAll('.pattern-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.pattern-details-btn')) {
                            const patternName = card.querySelector('.pattern-name').textContent;
                            const patterns = JSON.parse(document.getElementById('patterns-data').textContent);
                            const pattern = patterns.find(p => p.name === patternName);
                            if (pattern) {
                                showPatternDetails(pattern);
                            }
                        }
                    });
                });
            }, 100);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞
        function showPatternDetails(pattern) {
            console.log('Showing pattern details:', pattern);

            const modal = document.getElementById('pattern-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');

            modalTitle.textContent = pattern.name;

            modalBody.innerHTML = `
                <div class="pattern-details">

                    <div class="detail-section">
                        <img src="${imageUrl}" alt="${pattern.name}"
                             onerror="this.src='/static/images/patterns/default_pattern.svg'"
                             class="modal-pattern-image">
                    </div>

                    <div class="detail-section">
                        <h4><i class="fas fa-info-circle"></i> –û–ø–∏—Å–∞–Ω–∏–µ</h4>
                        <p class="detail-description">${pattern.description}</p>
                    </div>

                    <div class="detail-section">
                        <h4><i class="fas fa-bullseye"></i> –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</h4>
                        <div class="signals-grid">
                            <div class="signal-item">
                                <i class="fas fa-arrow-right"></i>
                                <strong>–í—Ö–æ–¥:</strong> <span class="signal-entry">${getEntrySignal(pattern.type)}</span>
                            </div>
                            <div class="signal-item">
                                <i class="fas fa-shield-alt"></i>
                                <strong>–°—Ç–æ–ø-–ª–æ—Å—Å:</strong> <span class="signal-stop">${getStopSignal(pattern.type)}</span>
                            </div>
                            <div class="signal-item">
                                <i class="fas fa-target"></i>
                                <strong>–¶–µ–ª—å:</strong> <span class="signal-target">${getTargetSignal(pattern.type)}</span>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4><i class="fas fa-chart-bar"></i> –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
                        <ul class="pattern-features">
                            ${getPatternFeatures(pattern).map(feature => `
                                <li>${feature}</li>
                            `).join('')}
                        </ul>
                    </div>

                    <div class="detail-section">
                        <h4><i class="fas fa-lightbulb"></i> –°–æ–≤–µ—Ç—ã –ø–æ —Ç–æ—Ä–≥–æ–≤–ª–µ</h4>
                        <div class="trading-tips">
                            ${getTradingTips(pattern).map(tip => `
                                <div>${tip}</div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4><i class="fas fa-exclamation-triangle"></i> –ß—Ç–æ –∏—Å–∫–∞—Ç—å</h4>
                        <div class="key-points">
                            ${getKeyPoints(pattern).map(point => `
                                <div>${point}</div>
                            `).join('')}
                        </div>
                    </div>

                    ${pattern.easter_egg ? `
                    <div class="detail-section">
                        <h4><i class="fas fa-key"></i> –°–µ–∫—Ä–µ—Ç —É—Å–ø–µ—Ö–∞</h4>
                        <div class="key-points">
                            <div>${pattern.easter_egg}</div>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.querySelector('.modal-content').style.transform = 'translateY(0) scale(1)';
            }, 10);
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getPatternTypeClass(type) {
            const typeMap = {
                '–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–π': 'reversal',
                '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è': 'continuation',
                '–°–≤–µ—á–Ω–æ–π': 'candlestick'
            };
            return typeMap[type] || 'reversal';
        }

        function getTrendDirection(type) {
            return type === '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è' ? '–°–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥—É' : '–†–∞–∑–≤–æ—Ä–æ—Ç —Ç—Ä–µ–Ω–¥–∞';
        }

        function getEntrySignal(type) {
            const signals = {
                '–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–π': '–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ –∏ –ø—Ä–æ–±–æ—è –∫–ª—é—á–µ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è',
                '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è': '–ù–∞ –æ—Ç–∫–∞—Ç–µ –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—é —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –æ–±—ä–µ–º–∞',
                '–°–≤–µ—á–Ω–æ–π': '–ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–≤–µ—á–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Å–≤–µ—á–æ–π'
            };
            return signals[type] || '–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∏ confluence —Ñ–∞–∫—Ç–æ—Ä–æ–≤';
        }

        function getStopSignal(type) {
            const stops = {
                '–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–π': '2-3% –∑–∞ –∫–ª—é—á–µ–≤—ã–º —É—Ä–æ–≤–Ω–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è',
                '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è': '1-2% –∑–∞ –ª–æ–∫–∞–ª—å–Ω—ã–º –º–∏–Ω–∏–º—É–º–æ–º/–º–∞–∫—Å–∏–º—É–º–æ–º',
                '–°–≤–µ—á–Ω–æ–π': '–ó–∞ —ç–∫—Å—Ç—Ä–µ–º—É–º–æ–º —Å–≤–µ—á–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è'
            };
            return stops[type] || '2-3% –∑–∞ –∫–ª—é—á–µ–≤—ã–º —É—Ä–æ–≤–Ω–µ–º';
        }

        function getTargetSignal(type) {
            const targets = {
                '–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–π': '1:2-1:3 —Ä–∏—Å–∫/–≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ, –∏–∑–º–µ—Ä–µ–Ω–∏–µ –æ—Ç –ª–∏–Ω–∏–∏ —à–µ–∏',
                '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è': '1:1.5-1:2 —Ä–∏—Å–∫/–≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ, –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞',
                '–°–≤–µ—á–Ω–æ–π': '1:1-1:1.5 —Ä–∏—Å–∫/–≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ, –±–ª–∏–∂–∞–π—à–∏–µ —É—Ä–æ–≤–Ω–∏'
            };
            return targets[type] || '1:1.5 —Ä–∏—Å–∫/–≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ';
        }

        function getPatternFeatures(pattern) {
            return [
                `–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: ${pattern.confidence}`,
                `–¢–∏–ø: ${pattern.type}`,
                `–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞: ${getSuccessProbability(pattern.confidence)}`,
                `–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º: ${getRecommendedTimeframe(pattern.type)}`,
                pattern.easter_egg ? `–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç: ${pattern.easter_egg}` : '–¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±—ä–µ–º–æ–º'
            ];
        }

        function getSuccessProbability(confidence) {
            const probabilities = {
                '–í—ã—Å–æ–∫–∞—è': '70-80%',
                '–°—Ä–µ–¥–Ω—è—è': '50-60%',
                '–ù–∏–∑–∫–∞—è': '30-40%'
            };
            return probabilities[confidence] || '50-60%';
        }

        function getRecommendedTimeframe(type) {
            const timeframes = {
                '–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–π': '4H - Daily',
                '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è': '1H - 4H',
                '–°–≤–µ—á–Ω–æ–π': '15M - 1H'
            };
            return timeframes[type] || '1H - 4H';
        }

        function getTradingTips(pattern) {
            return [
                '–î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞',
                '–ò—â–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–∞–º–∏ (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–±–æ–µ)',
                '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, MACD) –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è',
                '–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å—Ç–æ–ø-–ª–æ—Å—Å —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–¥–µ–ª–∫—É',
                '–§–∏–∫—Å–∏—Ä—É–π—Ç–µ —á–∞—Å—Ç—å –ø—Ä–∏–±—ã–ª–∏ –Ω–∞ –ø–µ—Ä–≤–æ–º —Ü–µ–ª–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ',
                '–¢–æ—Ä–≥—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —á–µ—Ç–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤'
            ];
        }

        function getKeyPoints(pattern) {
            return [
                '–ß–µ—Ç–∫–æ–µ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é',
                '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—É—â–µ–º—É —Ä—ã–Ω–æ—á–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∏ —Ç—Ä–µ–Ω–¥—É',
                '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–æ–º —Ç–æ—Ä–≥–æ–≤ –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö',
                '–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤',
                '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º—É (–±–æ–ª—å—à–∏–µ TF = –Ω–∞–¥–µ–∂–Ω–µ–µ)'
            ];
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function initSearchAndFilters() {
            const searchInput = document.getElementById('pattern-search');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const viewButtons = document.querySelectorAll('.view-btn');

            // –ü–æ–∏—Å–∫
            searchInput.addEventListener('input', (e) => {
                filterPatterns(e.target.value.toLowerCase());
            });

            // –§–∏–ª—å—Ç—Ä—ã
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    applyFilter(btn.dataset.filter);
                });
            });

            // –í–∏–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            viewButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    viewButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    changeView(btn.dataset.view);
                });
            });
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
        function filterPatterns(searchTerm) {
            const patterns = document.querySelectorAll('.pattern-card');
            let visibleCount = 0;

            patterns.forEach(pattern => {
                const patternName = pattern.querySelector('.pattern-name').textContent.toLowerCase();
                const patternDescription = pattern.querySelector('.pattern-description').textContent.toLowerCase();
                const isVisible = patternName.includes(searchTerm) ||
                                 patternDescription.includes(searchTerm) ||
                                 searchTerm === '';

                pattern.style.display = isVisible ? 'block' : 'none';
                if (isVisible) visibleCount++;
            });

            // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            if (visibleCount === 0 && searchTerm !== '') {
                document.getElementById('patterns-grid').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è "${searchTerm}"</p>
                        <button class="btn btn-primary" onclick="document.getElementById('pattern-search').value='';filterPatterns('')">
                            <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫
                        </button>
                    </div>
                `;
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞
        function applyFilter(filterType) {
            const patterns = document.querySelectorAll('.pattern-card');
            let visibleCount = 0;

            patterns.forEach(pattern => {
                const patternType = pattern.dataset.type;
                const isVisible = filterType === 'all' || patternType === filterType;

                pattern.style.display = isVisible ? 'block' : 'none';
                if (isVisible) visibleCount++;
            });

            if (visibleCount === 0 && filterType !== 'all') {
                document.getElementById('patterns-grid').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-filter"></i>
                        <p>–ù–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Ç–∏–ø–∞ "${filterType}"</p>
                        <button class="btn btn-primary" onclick="applyFilter('all')">
                            <i class="fas fa-eye"></i> –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
                        </button>
                    </div>
                `;
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function changeView(viewType) {
            const grid = document.getElementById('patterns-grid');

            if (viewType === 'list') {
                grid.classList.add('list-view');
            } else {
                grid.classList.remove('list-view');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function initModal() {
            const modal = document.getElementById('pattern-modal');
            const closeBtn = document.getElementById('modal-close');

            // –ù–∞—á–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            modal.style.opacity = '0';
            modal.querySelector('.modal-content').style.transform = 'translateY(20px) scale(0.95)';
            modal.style.transition = 'opacity 0.3s ease';
            modal.querySelector('.modal-content').style.transition = 'transform 0.3s ease';

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–Ω–æ–ø–∫–µ
            closeBtn.addEventListener('click', closeModal);

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.style.display === 'flex') {
                    closeModal();
                }
            });
        }

        function closeModal() {
            const modal = document.getElementById('pattern-modal');

            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
            modal.style.opacity = '0';
            modal.querySelector('.modal-content').style.transform = 'translateY(20px) scale(0.95)';

            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 300);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏
        function showErrorState(message) {
            const container = document.getElementById('patterns-grid');
            container.innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="loadPatternsData()">
                        <i class="fas fa-sync-alt"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            `;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('cryptoanalyst_theme', newTheme);

                    const themeIcon = document.querySelector('#theme-toggle i');
                    if (themeIcon) {
                        themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                    }
                });
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
            const savedTheme = localStorage.getItem('cryptoanalyst_theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const themeIcon = document.querySelector('#theme-toggle i');
            if (themeIcon) {
                themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
        window.loadPatternsData = loadPatternsData;
        window.showPatternDetails = showPatternDetails;
        window.applyFilter = applyFilter;
        window.filterPatterns = filterPatterns;
        window.closeModal = closeModal;
    </script>

    <!-- –°–∫—Ä—ã—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö -->
    <script id="patterns-data" type="application/json">[]</script>
<script src="{{ url_for('static', filename='js/i18n.js') }}"></script>
\1
</html>