<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ - CryptoAnalyst Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/patterns.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìà</text></svg>">
</head>

<body>
    <div class="container">
        <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π header –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ -->
        {% include '_header.html' %}

        <main class="patterns-main">
            <!-- Hero Section -->
            <section class="patterns-hero">
                <div class="hero-content">
                    <h1><i class="fas fa-shapes"></i> –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤</h1>
                    <p class="hero-description">
                        –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
                        –ò–∑—É—á–∞–π—Ç–µ, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–π—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
                    </p>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <i class="fas fa-project-diagram"></i>
                            <span>20+ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-chart-line"></i>
                            <span>–†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-lightbulb"></i>
                            <span>–¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Search and Filter Section -->
            <section class="patterns-controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="pattern-search" placeholder="–ü–æ–∏—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤..." class="search-input">
                </div>

                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                    <button class="filter-btn" data-filter="–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–µ">–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–µ</button>
                    <button class="filter-btn" data-filter="–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è">–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</button>
                    <button class="filter-btn" data-filter="–°–≤–µ—á–Ω—ã–µ">–°–≤–µ—á–Ω—ã–µ</button>
                </div>

                <div class="view-controls">
                    <button class="view-btn active" data-view="grid">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" data-view="list">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </section>

            <!-- Patterns Grid -->
            <section class="patterns-container">
                <div class="patterns-grid" id="patterns-grid">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤...</p>
                    </div>
                </div>
            </section>

            <!-- Pattern Detail Modal -->
            <div class="modal-overlay" id="pattern-modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-title">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞</h3>
                        <button class="modal-close" id="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body" id="modal-body">
                        <!-- Content will be loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Educational Section -->
            <section class="educational-section">
                <h2><i class="fas fa-graduation-cap"></i> –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏</h2>

                <div class="education-grid">
                    <div class="education-card">
                        <i class="fas fa-binoculars"></i>
                        <h4>1. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ</h4>
                        <p>–ò—â–∏—Ç–µ —á–µ—Ç–∫–∏–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ. –ü–∞—Ç—Ç–µ—Ä–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ä–æ—à–æ –≤–∏–¥–∏–º—ã–º –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é.</p>
                    </div>

                    <div class="education-card">
                        <i class="fas fa-check-circle"></i>
                        <h4>2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h4>
                        <p>–î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞. –ò—â–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–∞–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏.</p>
                    </div>

                    <div class="education-card">
                        <i class="fas fa-arrow-right"></i>
                        <h4>3. –í—Ö–æ–¥</h4>
                        <p>–í—Ö–æ–¥–∏—Ç–µ –≤ —Å–¥–µ–ª–∫—É –ø–æ—Å–ª–µ –ø—Ä–æ–±–æ—è –∫–ª—é—á–µ–≤—ã—Ö —É—Ä–æ–≤–Ω–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–æ–ø-–ª–æ—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏.</p>
                    </div>

                    <div class="education-card">
                        <i class="fas fa-target"></i>
                        <h4>4. –¶–µ–ª–∏</h4>
                        <p>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ—Ä–µ–Ω–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω–∞. –§–∏–∫—Å–∏—Ä—É–π—Ç–µ –ø—Ä–∏–±—ã–ª—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.</p>
                    </div>
                </div>
            </section>

            <!-- Common Mistakes Section -->
            <section class="mistakes-section">
                <h2><i class="fas fa-exclamation-triangle"></i> –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏</h2>

                <div class="mistakes-list">
                    <div class="mistake-item">
                        <i class="fas fa-times-circle"></i>
                        <div class="mistake-content">
                            <h4>–¢–æ—Ä–≥–æ–≤–ª—è –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h4>
                            <p>–ù–µ –≤—Ö–æ–¥–∏—Ç–µ –≤ —Å–¥–µ–ª–∫—É –¥–æ –ø–æ–ª–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞. –¢–µ—Ä–ø–µ–Ω–∏–µ - –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É.</p>
                        </div>
                    </div>

                    <div class="mistake-item">
                        <i class="fas fa-times-circle"></i>
                        <div class="mistake-content">
                            <h4>–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–º–∞</h4>
                            <p>–û–±—ä–µ–º - –≤–∞–∂–Ω–µ–π—à–∏–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π —Ñ–∞–∫—Ç–æ—Ä. –ë–µ–∑ –æ–±—ä–µ–º–∞ –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–µ–Ω–∞–¥–µ–∂–µ–Ω.</p>
                        </div>
                    </div>

                    <div class="mistake-item">
                        <i class="fas fa-times-circle"></i>
                        <div class="mistake-content">
                            <h4>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞</h4>
                            <p>–í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å—Ç–æ–ø-–ª–æ—Å—Å. –ù–∏ –æ–¥–∏–Ω –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–µ –¥–∞–µ—Ç 100% –≥–∞—Ä–∞–Ω—Ç–∏–∏.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="patterns-footer">
            <div class="footer-content">
                <p>&copy; 2025 CryptoAnalyst Pro | –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤</p>
                <p class="educational-note">
                    <i class="fas fa-info-circle"></i>
                    –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–æ–¥–∏—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑.
                </p>
            </div>
        </footer>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let allPatterns = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
            loadPatternsData();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            initSearchAndFilters();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            initModal();

            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã —Å —Å–∏—Å—Ç–µ–º–æ–π
            initTheme();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
        function initTheme() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);

            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º –≤ header
            const themeToggle = document.getElementById('header-theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    updateThemeStyles();
                });
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(updateThemeStyles, 100);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π —Ç–µ–º—ã
        function updateThemeStyles() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã
            const themeIcon = document.querySelector('.theme-toggle-btn i');
            if (themeIcon) {
                themeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
        async function loadPatternsData() {
            try {
                const container = document.getElementById('patterns-grid');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
                container.innerHTML = `
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤...</p>
                    </div>
                `;

                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —á–µ—Ä–µ–∑ API
                const response = await fetch('/api/patterns/cheatsheet');
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }

                allPatterns = await response.json();

                // –†–µ–Ω–¥–µ—Ä–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã
                renderPatterns(allPatterns);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:', error);
                showErrorState('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤');
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
        function renderPatterns(patterns) {
            const container = document.getElementById('patterns-grid');

            if (!patterns || patterns.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>–ü–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        <button class="reset-filters-btn" onclick="resetFilters()">
                            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = patterns.map(pattern => {
                const imageUrl = `/static/images/patterns/${pattern.name.toLowerCase().replace(/\s+/g, '_')}.svg`;

                return `
                    <div class="pattern-card" data-type="${pattern.type}" data-name="${pattern.name.toLowerCase()}">
                        <div class="pattern-header">
                            <div class="pattern-icon">
                                <i class="fas ${getPatternIcon(pattern.name)}"></i>
                            </div>
                            <div class="pattern-title">
                                <h3 class="pattern-name">${pattern.name}</h3>
                                <span class="pattern-type-badge ${getPatternTypeClass(pattern.type)}">
                                    ${pattern.type}
                                </span>
                            </div>
                        </div>

                        <div class="pattern-visual">
                            <img src="${imageUrl}" alt="${pattern.name}"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                 class="pattern-image">
                            <div class="image-fallback" style="display: none;">
                                <i class="fas fa-chart-line"></i>
                                <span>${pattern.name}</span>
                            </div>
                        </div>

                        <div class="pattern-body">
                            <p class="pattern-description">${pattern.description}</p>

                            <div class="pattern-confidence">
                                <span class="confidence-label">–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:</span>
                                <div class="confidence-bar">
                                    <div class="confidence-fill ${getConfidenceClass(pattern.reliability)}"
                                         style="width: ${getConfidenceWidth(pattern.reliability)}%">
                                    </div>
                                </div>
                                <span class="confidence-text">${pattern.reliability}</span>
                            </div>

                            <div class="pattern-features">
                                ${pattern.keyPoints.slice(0, 3).map(point => `
                                    <span class="feature-tag">
                                        <i class="fas fa-check-circle"></i> ${point}
                                    </span>
                                `).join('')}
                            </div>
                        </div>

                        <div class="pattern-footer">
                            <button class="pattern-details-btn" onclick="openPatternModal('${pattern.name}')">
                                <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function initSearchAndFilters() {
            const searchInput = document.getElementById('pattern-search');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const viewButtons = document.querySelectorAll('.view-btn');

            // –ü–æ–∏—Å–∫
            searchInput.addEventListener('input', debounce(function(e) {
                filterPatterns();
            }, 300));

            // –§–∏–ª—å—Ç—Ä—ã
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterPatterns();
                });
            });

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞
            viewButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    viewButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const viewType = this.getAttribute('data-view');
                    const grid = document.getElementById('patterns-grid');
                    grid.className = viewType === 'list' ? 'patterns-list' : 'patterns-grid';
                });
            });
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
        function filterPatterns() {
            const searchText = document.getElementById('pattern-search').value.toLowerCase();
            const activeFilter = document.querySelector('.filter-btn.active').getAttribute('data-filter');

            const filtered = allPatterns.filter(pattern => {
                const matchesSearch = pattern.name.toLowerCase().includes(searchText) ||
                                    pattern.description.toLowerCase().includes(searchText) ||
                                    pattern.type.toLowerCase().includes(searchText);

                const matchesFilter = activeFilter === 'all' || pattern.type === activeFilter;

                return matchesSearch && matchesFilter;
            });

            renderPatterns(filtered);
        }

        // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function resetFilters() {
            document.getElementById('pattern-search').value = '';
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-filter') === 'all') {
                    btn.classList.add('active');
                }
            });
            filterPatterns();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function initModal() {
            const modal = document.getElementById('pattern-modal');
            const closeBtn = document.getElementById('modal-close');

            closeBtn.addEventListener('click', closeModal);

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.style.display === 'flex') {
                    closeModal();
                }
            });
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞
        async function openPatternModal(patternName) {
            try {
                const modal = document.getElementById('pattern-modal');
                const title = document.getElementById('modal-title');
                const body = document.getElementById('modal-body');

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞—Ç—Ç–µ—Ä–Ω–µ
                const response = await fetch(`/api/patterns/${encodeURIComponent(patternName)}`);
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–∞');
                }

                const pattern = await response.json();

                title.textContent = pattern.name;

                const imageUrl = `/static/images/patterns/${pattern.name.toLowerCase().replace(/\s+/g, '_')}.svg`;

                body.innerHTML = `
                    <div class="modal-pattern-content">
                        <div class="modal-header-info">
                            <span class="pattern-type-badge ${getPatternTypeClass(pattern.type)}">
                                ${pattern.type}
                            </span>
                            <span class="pattern-confidence-badge ${getConfidenceClass(pattern.reliability)}">
                                <i class="fas ${getConfidenceIcon(pattern.reliability)}"></i>
                                ${pattern.reliability}
                            </span>
                        </div>

                        <div class="modal-visual">
                            <img src="${imageUrl}" alt="${pattern.name}"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                 class="modal-pattern-image">
                            <div class="modal-image-fallback" style="display: none;">
                                <i class="fas fa-chart-line"></i>
                                <span>${pattern.name}</span>
                            </div>
                        </div>

                        <div class="modal-description">
                            <h4>–û–ø–∏—Å–∞–Ω–∏–µ</h4>
                            <p>${pattern.description}</p>
                        </div>

                        <div class="modal-trading-info">
                            <div class="info-grid">
                                <div class="info-item">
                                    <i class="fas fa-trending-up"></i>
                                    <strong>–¢—Ä–µ–Ω–¥:</strong> ${pattern.trend}
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-chart-bar"></i>
                                    <strong>–û–±—ä–µ–º:</strong> ${pattern.volume_characteristics}
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-bullseye"></i>
                                    <strong>–¶–µ–ª—å:</strong> ${pattern.price_target}
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-check-circle"></i>
                                    <strong>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:</strong> ${pattern.confirmation}
                                </div>
                            </div>
                        </div>

                        <div class="modal-features">
                            <h4>–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
                            <div class="features-list">
                                ${pattern.keyPoints.map(point => `
                                    <div class="feature-item">
                                        <i class="fas fa-check"></i>
                                        <span>${point}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="modal-tips">
                            <h4>–°–æ–≤–µ—Ç—ã –ø–æ —Ç–æ—Ä–≥–æ–≤–ª–µ</h4>
                            <div class="tips-list">
                                ${pattern.trading_tips.map(tip => `
                                    <div class="tip-item">
                                        <i class="fas fa-lightbulb"></i>
                                        <span>${tip}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="modal-mistakes">
                            <h4>–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏</h4>
                            <div class="mistakes-list">
                                ${pattern.common_mistakes.map(mistake => `
                                    <div class="mistake-item">
                                        <i class="fas fa-times-circle"></i>
                                        <span>${mistake}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –ø–∞—Ç—Ç–µ—Ä–Ω–∞:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞—Ç—Ç–µ—Ä–Ω–µ');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            const modal = document.getElementById('pattern-modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getPatternIcon(patternName) {
            const icons = {
                '–ì–æ–ª–æ–≤–∞ –∏ –ø–ª–µ—á–∏': 'fa-user-friends',
                '–î–≤–æ–π–Ω–∞—è –≤–µ—Ä—à–∏–Ω–∞': 'fa-mountain',
                '–î–≤–æ–π–Ω–æ–µ –¥–Ω–æ': 'fa-valley',
                '–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫': 'fa-play',
                '–§–ª–∞–≥': 'fa-flag',
                '–í—ã–º–ø–µ–ª': 'fa-flag-checkered',
                '–ú–æ–ª–æ—Ç': 'fa-hammer',
                '–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π': 'fa-user',
                '–ë—ã—á—å–µ –ø–æ–≥–ª–æ—â–µ–Ω–∏–µ': 'fa-arrow-up',
                '–ú–µ–¥–≤–µ–∂—å–µ –ø–æ–≥–ª–æ—â–µ–Ω–∏–µ': 'fa-arrow-down',
                '–î–æ–¥–∂–∏': 'fa-balance-scale'
            };
            return icons[patternName] || 'fa-chart-line';
        }

        function getPatternTypeClass(type) {
            const classes = {
                '–†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–µ': 'reversal',
                '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è': 'continuation',
                '–°–≤–µ—á–Ω—ã–µ': 'candlestick'
            };
            return classes[type] || 'default';
        }

        function getConfidenceClass(confidence) {
            const classes = {
                '–í—ã—Å–æ–∫–∞—è': 'high',
                '–°—Ä–µ–¥–Ω—è—è': 'medium',
                '–ù–∏–∑–∫–∞—è': 'low'
            };
            return classes[confidence] || 'medium';
        }

        function getConfidenceWidth(confidence) {
            const widths = {
                '–í—ã—Å–æ–∫–∞—è': 80,
                '–°—Ä–µ–¥–Ω—è—è': 50,
                '–ù–∏–∑–∫–∞—è': 30
            };
            return widths[confidence] || 50;
        }

        function getConfidenceIcon(confidence) {
            const icons = {
                '–í—ã—Å–æ–∫–∞—è': 'fa-check-circle',
                '–°—Ä–µ–¥–Ω—è—è': 'fa-info-circle',
                '–ù–∏–∑–∫–∞—è': 'fa-exclamation-circle'
            };
            return icons[confidence] || 'fa-info-circle';
        }

        function showErrorState(message) {
            const container = document.getElementById('patterns-grid');
            container.innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>${message}</p>
                    <button class="retry-btn" onclick="loadPatternsData()">
                        <i class="fas fa-redo"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            `;
        }

        // Debounce —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'IMG' && e.target.classList.contains('pattern-image')) {
                e.target.style.display = 'none';
                const fallback = e.target.nextElementSibling;
                if (fallback && fallback.classList.contains('image-fallback')) {
                    fallback.style.display = 'flex';
                }
            }
        }, true);
    </script>
</body>
</html>